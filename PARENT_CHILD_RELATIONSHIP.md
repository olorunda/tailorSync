# Parent-Child Relationship Between Users

This document describes the implementation of a parent-child relationship between users, where a child user can access data generated by their parent user.

## Overview

When a user creates another user, the newly created user (child) should have access to the data generated by the parent user. This allows for hierarchical data access within the application.

## Implementation

The implementation consists of the following components:

1. **Database Migration**: Added a `parent_id` field to the `users` table, which references the ID of the parent user.
2. **User Model Updates**: 
   - Added `parent_id` to the fillable attributes
   - Added `parent()` and `children()` relationships
   - Added methods to access data from both the user and their parent (e.g., `allClients()`, `allOrders()`, etc.)
3. **User Creation**: Updated the team member creation process to set the `parent_id` to the ID of the currently authenticated user.

## Database Schema Changes

Added a foreign key constraint to the `users` table:

```php
$table->foreignId('parent_id')->nullable()->constrained('users')->onDelete('set null');
```

## User Model Relationships

Added the following relationships to the User model:

```php
/**
 * Get the parent user.
 */
public function parent(): BelongsTo
{
    return $this->belongsTo(User::class, 'parent_id');
}

/**
 * Get the child users.
 */
public function children(): HasMany
{
    return $this->hasMany(User::class, 'parent_id');
}
```

## Data Access Methods

Added methods to the User model to access data from both the user and their parent:

```php
/**
 * Get all clients, including those of the parent user.
 */
public function allClients()
{
    if ($this->parent_id) {
        return Client::where(function ($query) {
            $query->where('user_id', $this->id)
                  ->orWhere('user_id', $this->parent_id);
        });
    }
    
    return $this->clients();
}
```

Similar methods were added for other types of data (orders, designs, inventory items, messages, appointments, invoices, payments, expenses, team members, and tasks).

## User Creation

Updated the team member creation process to set the `parent_id` to the ID of the currently authenticated user:

```php
$user = User::create([
    // ... other fields ...
    'parent_id' => Auth::id(), // Set the parent_id to the currently authenticated user
]);
```

## Usage

To access data from both the user and their parent, use the `all*` methods instead of the regular relationship methods:

```php
// Get only the user's own clients
$userClients = $user->clients()->get();

// Get all clients, including those of the parent user
$allClients = $user->allClients()->get();
```

## Testing

A test command was created to verify the implementation:

```bash
php artisan app:test-parent-child-relationship
```

The test confirms that:
1. Child users can access their own data
2. Child users can access their parent user's data
3. Parent users can access their own data
4. Parent users cannot access their child users' data
